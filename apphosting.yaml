# Google Cloud App Hosting configuration
# https://firebase.google.com/docs/app-hosting/get-started

runConfig:
  # CPU and memory allocation
  cpu: 1
  memoryMiB: 512
  # Minimum instances to keep warm
  minInstances: 0
  maxInstances: 10
  # Concurrency - number of requests per instance
  concurrency: 80

env:
  # Google Secret Manager has the values
  - variable: NODE_ENV
    value: production
  - variable: GOOGLE_CLOUD_PROJECT_ID
    secret: projects/359757699589/secrets/GOOGLE_CLOUD_PROJECT_ID
  - variable: DATABASE_URL
    secret: projects/359757699589/secrets/DATABASE_URL
  - variable: DIRECT_URL
    secret: projects/359757699589/secrets/DIRECT_URL
  - variable: GOOGLE_CLIENT_ID
    secret: projects/359757699589/secrets/GOOGLE_CLIENT_ID
  - variable: GOOGLE_CLIENT_SECRET
    secret: projects/359757699589/secrets/GOOGLE_CLIENT_SECRET

# Build configuration
build:
  # Root directory for the build
  rootDirectory: .
  
  # Build commands
  buildCommand: |
    # Install root dependencies (including devDependencies like turbo)
    npm install --include=dev

    # Install backend dependencies directly
    cd backend
    npm install
    npx prisma generate
  
  # Output directory (backend contains the server)
  outputDirectory: backend
  
  # Start command
  startCommand: npm start
